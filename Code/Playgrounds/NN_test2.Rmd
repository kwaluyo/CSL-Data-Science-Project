---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#install.packages("keras")
#install.packages("mlbench")
#install.packages("dplyr")
#install.packages("magrittr")
#install.packages("neuralnet")

```

```{r}
library(keras)
library(mlbench)
library(dplyr)
library(magrittr)
library(neuralnet)
library(tensorflow)
```

```{r}
load("./exp_blood_t.Rdata")
load("./exp_other_t.Rdata")
```

```{r}
colnames(exp_other_t) <- paste0("resp_", colnames(exp_other_t))
```

```{r}
NUM_GENE = 50
exp_combined = cbind(exp_blood_t[,1:NUM_GENE], exp_other_t[,1:NUM_GENE])
```

```{r}
x <- paste(c(colnames(exp_blood_t[,1:NUM_GENE])),collapse="+")
y <- paste(c(colnames(exp_other_t[,1:NUM_GENE])),collapse="+")

f <- paste(c(y, "~", x),collapse="")
```

```{r}
f
```





```{r}
try = exp_combined
```


```{r}
# Matrix

data = as.matrix(try)
dimnames(data) = NULL
```

```{r}
# Partition



set.seed(321)
ind = sample(2, nrow(data), replace = T, prob = c(0.7, 0.3))
training = data[ind == 1, 1:NUM_GENE]
test = data[ind == 2, 1:NUM_GENE]

trainingtarget = data[ind == 1, (NUM_GENE+1):(NUM_GENE*2)]
testtarget = data[ind == 2, (NUM_GENE+1):(NUM_GENE*2)]

```

```{r}
# Normalize

#m = colMeans(training)
#s = apply(training, 2, sd)
#training = scale(training, center = m, scale = s)
#test = scale(test, center = m, scale = s)
```

```{r}
# Create Model

model = keras_model_sequential()
model %>% layer_dense(units = 5, activation = 'relu', input_shape = c(NUM_GENE)) %>%
          layer_dense(units = NUM_GENE)
```

```{r}
# Compile

model %>% compile(loss = 'mse',
                  optimizer = 'rmsprop',
                  metrics = 'mae')

```

```{r}
# Fit Model

mymodel = model %>% 
  fit(training,
      trainingtarget,
      epochs = 100,
      batch_size = 32,
      validation_split = 0.2)
```


```{r}
# Evaluate

model %>% evaluate(test, testtarget)
pred = model %>% predict(test)
```


